@page
@model APP_SITE_ACADEMIA.Pages.Shared.Home.IndexModel
@{
    ViewData["Title"] = "Página Inicial";
}

@if (!string.IsNullOrEmpty(Model.Mensagem))
{
    <div style="margin-top:15px; color:darkorange; font-weight:bold;">
        @Model.Mensagem
    </div>
}


<div class="container text-center mt-5">
    <h1 class="display-4 mb-4">Bem-vindo à Academia</h1>

    <h5 class="font-weight-bold mb-4">Nome do Aluno: @Model.NomeAluno</h5>

    <button id="iniciarEncerrarTreino" class="btn btn-success mt-4">Iniciar Treino</button>
    <h4 id="tempoTreino" class="mt-3 text-primary">00:00:00</h4>

    <script>
        let intervalo;
        let tempoSegundos = 0;
        let treinoAtivo = false;

        const botao = document.getElementById("iniciarEncerrarTreino");
        const tempoDisplay = document.getElementById("tempoTreino");

        function formatarTempo(segundos) {
            const h = String(Math.floor(segundos / 3600)).padStart(2, '0');
            const m = String(Math.floor((segundos % 3600) / 60)).padStart(2, '0');
            const s = String(segundos % 60).padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        function atualizarTempo() {
            tempoSegundos++;
            tempoDisplay.textContent = formatarTempo(tempoSegundos);
        }

        botao.addEventListener("click", function () {
            if (!treinoAtivo) {
                tempoSegundos = 0;
                tempoDisplay.textContent = "00:00:00";
                treinoAtivo = true;
                botao.textContent = "Encerrar Treino";
                botao.classList.remove("btn-success");
                botao.classList.add("btn-danger");
                intervalo = setInterval(atualizarTempo, 1000);
            } else {
                treinoAtivo = false;
                clearInterval(intervalo);
                botao.textContent = "Iniciar Treino";
                botao.classList.remove("btn-danger");
                botao.classList.add("btn-success");
            }
        });
    </script>

    <div class="mt-4 mb-5">
        <h4 class="font-weight-bold">Selecione o dia da semana:</h4>
        <div class="btn-group btn-group-toggle" data-toggle="buttons">
            @{
                var ordemDias = new[] { "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado", "Domingo" };
                var diasDisponiveis = Model.ListaTreinos
                .Select(t => t.DiaSemana?.Trim())
                .Where(d => !string.IsNullOrEmpty(d))
                .Distinct()
                .OrderBy(d =>
                {
                    var match = ordemDias.FirstOrDefault(o =>
                            d.StartsWith(o, StringComparison.OrdinalIgnoreCase));
                    return match != null ? Array.IndexOf(ordemDias, match) : 999;
                });
            }

            @foreach (var dia in diasDisponiveis)
            {
                <label class="btn btn-outline-primary">
                    <input type="radio" name="diasSemana" value="@dia"> @dia
                </label>
            }
        </div>
    </div>

    <div id="treino" class="mt-4">
        <h4 class="font-weight-bold">Treino do Dia</h4>
        <div id="treinoDescricao" class="text-muted">Selecione um dia para ver o treino correspondente.</div>
    </div>
</div>

@section Scripts {
    <script>
        const treinos = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ListaTreinos));

        document.querySelectorAll('input[name="diasSemana"]').forEach(radio => {
            radio.addEventListener('change', function () {
                const treinoContainer = document.getElementById('treinoDescricao');
                const selecionado = this.value;
                const treinosDoDia = treinos.filter(t => t.DiaSemana === selecionado);

                if (treinosDoDia.length === 0) {
                    treinoContainer.innerHTML = `<p>Nenhum treino cadastrado para ${selecionado}.</p>`;
                    return;
                }

                treinoContainer.innerHTML = treinosDoDia.map(t => {
                    const imagem = t.ImagemBase64 ? `<img src="data:image/png;base64,${t.ImagemBase64}" class='img-fluid rounded shadow mt-3' />` : "";
                    return `
                        <div class='treino-item mt-4'>
                            <h5 style='color:#E65C00;'>${t.Nome}</h5>
                            <p>${t.Descricao}</p>
                            ${imagem}
                        </div>`;
                }).join("");
            });
        });
    </script>
}

<style>
    .btn-group-toggle .btn {
        font-weight: bold;
        padding: 15px 20px;
        font-size: 16px;
        border-radius: 8px;
        border-color: #E65C00;
        color: #E65C00;
        transition: 0.3s;
    }

        .btn-group-toggle .btn:hover {
            background-color: #E65C00;
            color: white;
            transform: scale(1.1);
        }

    .treino-item {
        margin-bottom: 40px;
    }
</style>
